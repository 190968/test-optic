(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{346:function(t,r,e){},397:function(t,r,e){"use strict";var _=e(346);e.n(_).a},409:function(t,r,e){"use strict";e.r(r);e(28);var _=e(4),n=e(0),o=e(12),d=e.n(o),c=e(9),l={props:["order"],data:function(){return{payment_list:!1,paymentTab:!1}},computed:Object(n.a)({},Object(c.b)({sessid:"user/getSessid"})),methods:{changeToPay:function(t,r,e){var _={"orderData[order]":t,"orderData[payment]":r,"orderData[paySystemId]":e,"orderData[allow_inner]":"N","orderData[refresh_prices]":"N","orderData[only_inner_full]":"Y",sessid:this.sessid};this.$axios.post("/api/v1/changepayment/",d.a.stringify(_)).then(function(t){var r=window.open("","Оплата","width=600,height=400");r.onload=function(){var div=r.document.createElement("div"),body=r.document.body;div.innerHTML=t.data,body.insertBefore(div,body.firstChild)}})},orderCancel:function(){var t={id:this.order.ORDER.ID};this.$axios.$post("/api/v1/order/canselOrder.php",d.a.stringify(t)),location.reload()},prev:function(){this.payment_list=!1},toPay:function(t,r){window.open("/api/v1/payment/?ORDER_ID=".concat(t,"&PAYMENT_ID=").concat(r),"Оплата","width=600,height=400")},changePayment:function(t,r){var e=this,_={"orderData[order]":t,"orderData[payment]":r,"orderData[allow_inner]":"N","orderData[refresh_prices]":"N","orderData[only_inner_full]":"Y",sessid:this.sessid};this.$axios.post("/api/v1/changepayment/",d.a.stringify(_)).then(function(t){t.data.PAYSYSTEMS_LIST&&(e.payment_list=t.data.PAYSYSTEMS_LIST)})}}},v=e(5),E={middleware:"auth",components:{CurrentOrder:Object(v.a)(l,function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"s-orders__item"},[e("div",{staticClass:"s-orders__header"},[e("div",{staticClass:"s-orders__name"},[e("b",[t._v("Заказ № "+t._s(t.order.ORDER.ACCOUNT_NUMBER)+" ОТ "+t._s(t.order.ORDER.DATE_INSERT_FORMATED)+", "+t._s(t.order.count_basket)+" на сумму "+t._s(t.order.ORDER.FORMATED_PRICE))])])]),t._v(" "),e("div",{staticClass:"s-orders__body"},[t._m(0),t._v(" "),t._l(t.order.PAYMENT,function(r,_){return e("div",{key:_},[e("div",{staticClass:"s-orders__heading"},[e("p",[t._v("Счет "+t._s(r.ACCOUNT_NUMBER)+" от "+t._s(r.DATE_BILL)+", "+t._s(r.PAY_SYSTEM_NAME))]),t._v(" "),"Y"===r.PAID?e("span",{staticClass:"s-orders__status green"},[t._v("Оплачено")]):"N"==t.order.ORDER.IS_ALLOW_PAY?e("span",{staticClass:"s-orders__status green"},[t._v("На проверке менеджером")]):e("span",{staticClass:"s-orders__status red"},[t._v("Не оплачено")])]),t._v(" "),e("p",{staticClass:"s-orders__data"},[t._v("Сумма к оплате по счету: "+t._s(r.FORMATED_SUM))]),t._v(" "),"N"===r.PAID&&"Y"!==r.IS_CASH?e("div",{staticClass:"s-orders__payment"},[e("div",[e("button",{staticClass:"s-orders__change btn-simple mb-2",attrs:{type:"button"},on:{click:function(e){return t.changePayment(t.order.ORDER.ACCOUNT_NUMBER,r.ACCOUNT_NUMBER)}}},[t._v("Сменить способ оплаты")]),t._v(" "),e("br"),t._v(" "),3!=r.PAY_SYSTEM_ID?e("button",{staticClass:"button black",attrs:{type:"button"},on:{click:function(e){return t.toPay(t.order.ORDER.ACCOUNT_NUMBER,r.ACCOUNT_NUMBER)}}},[t._v("Оплатить")]):t._e()]),t._v(" "),t.payment_list?e("div",[e("div",{staticClass:"s-orders__payment-wrapper"},t._l(t.payment_list,function(_,n){return e("label",{key:n,staticClass:"o-radio o-radio--img"},[e("input",{attrs:{name:"PAY_SYSTEM_ID",type:"radio"},on:{click:function(e){return t.changeToPay(t.order.ORDER.ACCOUNT_NUMBER,r.ACCOUNT_NUMBER,_.ID)}}}),t._v(" "),e("img",{attrs:{src:_.LOGOTIP,alt:""}}),t._v(" "),e("span",[t._v(t._s(_.PSA_NAME))]),t._v(" "),e("div",{staticClass:"o-radio__border"})])}),0),t._v(" "),e("button",{staticClass:"btn-simple",attrs:{type:"button"},on:{click:t.prev}},[t._v("Назад")])]):t._e()]):t._e()])}),t._v(" "),t._m(1),t._v(" "),t._l(t.order.SHIPMENT,function(r){return e("div",{key:r.ID},[e("div",{staticClass:"s-orders__heading"},[e("p",[t._v("Отгрузка\t№"+t._s(r.ACCOUNT_NUMBER)+", стоимость доставки "+t._s(r.FORMATED_DELIVERY_PRICE))]),t._v(" "),"Y"==r.DEDUCTED?e("span",{staticClass:"s-orders__status green"},[t._v("Отгружено")]):e("span",{staticClass:"s-orders__status red"},[t._v("Не отгружено")])]),t._v(" "),e("p",{staticClass:"s-orders__data"},[t._v("Статус отгрузки: "),e("span",{staticClass:"s-orders__status"},[t._v(t._s(r.DELIVERY_STATUS_NAME))])]),t._v(" "),e("p",{staticClass:"s-orders__data"},[t._v("Служба доставки: "+t._s(r.DELIVERY_NAME))]),t._v(" "),t._m(2,!0)])}),t._v(" "),e("div",{staticClass:"s-orders__buttons"},[e("nuxt-link",{staticClass:"s-orders__detail mr-4",attrs:{to:"?COPY_ORDER=Y&ID="+t.order.ORDER.ID}},[t._v("Подробнее о заказе")]),t._v(" "),e("nuxt-link",{staticClass:"s-orders__repeat mr-3",attrs:{to:"?COPY_ORDER=Y&ID="+t.order.ORDER.ID}},[t._v("Повторить заказ")]),t._v(" "),e("a",{staticClass:"s-orders__cancel",staticStyle:{cursor:"pointer"},on:{click:t.orderCancel}},[t._v("Отменить заказ")])],1)],2)])},[function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"s-orders__sub-header"},[r("span",[this._v("Оплата")]),this._v(" "),r("i")])},function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"s-orders__sub-header mt-3"},[r("span",[this._v("Доставка")]),this._v(" "),r("i")])},function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"s-orders__sub-header mt-3"},[r("i")])}],!1,null,null,null).exports},watch:{$route:function(t,r){var e=this;this.$store.dispatch("order/LOAD_ORDERS",{params:t.params,query:t.query}).then(function(t){t.copy?(e.$store.dispatch("basket/STATE"),e.$router.push("/basket")):(e.orders=t.orders,e.title=t.title)})}},asyncData:function(){var t=Object(_.a)(regeneratorRuntime.mark(function t(r){var e,_,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.store,r.error,_=r.params,n=r.query,t.next=3,e.dispatch("order/LOAD_ORDERS",{params:_,query:n});case 3:return o=t.sent,console.log(o),t.abrupt("return",{orders:o.orders,title:o.title});case 6:case"end":return t.stop()}},t)}));return function(r){return t.apply(this,arguments)}}()},h=(e(397),Object(v.a)(E,function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",[e("div",{staticClass:"content-header"},[e("div",{staticClass:"main-container"},[e("h2",[t._v("Мои заказы")]),t._v(" "),e("ul",{staticClass:"breadcrumbs"},[e("li",[e("nuxt-link",{attrs:{to:"/"}},[t._v("Главная")])],1),t._v(" "),e("li",[e("nuxt-link",{attrs:{to:"/personal"}},[t._v("Мой кабинет")])],1)])])]),t._v(" "),e("div",{staticClass:"orders main-container"},[e("div",{staticClass:"orders__nav"},["Y"==t.$route.query.filter_history?e("nuxt-link",{attrs:{to:"/personal/orders"}},[e("span",[t._v("Показать текущие заказы")])]):t._e(),t._v(" "),"Y"==t.$route.query.show_canceled||"Y"!=t.$route.query.filter_history&&"Y"!=t.$route.query.show_canceled?e("nuxt-link",{attrs:{to:{query:{filter_history:"Y"}}}},[e("span",[t._v("Посмотреть историю заказов")])]):t._e(),t._v(" "),"Y"==t.$route.query.filter_history&&"Y"!=t.$route.query.show_canceled?e("nuxt-link",{attrs:{to:{query:{filter_history:"Y",show_canceled:"Y"}}}},[e("span",[t._v("Посмотреть историю отмененных заказов")])]):t._e()],1),t._v(" "),"Y"==t.$route.query.filter_history?e("div",["Y"==t.$route.query.show_canceled?e("h2",[t._v("Отменённые заказы")]):e("h2",[t._v("История заказов")]),t._v(" "),e("div",{staticClass:"orders__small s-orders"},t._l(t.orders,function(r){return e("div",{key:r.ORDER.ID,staticClass:"s-orders__item"},[e("div",{staticClass:"s-orders__header"},[e("div",{staticClass:"s-orders__name"},[e("b",[t._v("Заказ № "+t._s(r.ORDER.ACCOUNT_NUMBER)+" ОТ "+t._s(r.ORDER.DATE_INSERT_FORMATED)+", "+t._s(r.count_basket)+" на сумму "+t._s(r.ORDER.FORMATED_PRICE))])]),t._v(" "),e("div",{staticClass:"s-orders__info"},["Y"==t.$route.query.show_canceled?e("p",{staticClass:"s-orders__canceled"},[t._v("Заказ отменен")]):e("p",[t._v("Выполнен")]),t._v(" "),e("p",{staticClass:"s-orders__date"},[t._v(t._s(r.ORDER.DATE_INSERT_FORMATED))])])]),t._v(" "),e("div",{staticClass:"s-orders__body p-20"},[e("nuxt-link",{staticClass:"s-orders__detail mr-auto",attrs:{to:"/personal/orders/"+r.ORDER.ID}},[t._v("Подробнее о заказе")]),t._v(" "),e("nuxt-link",{staticClass:"s-orders__repeat",attrs:{to:"?COPY_ORDER=Y&ID="+r.ORDER.ID}},[t._v("Повторить заказ")])],1)])}),0)]):e("div",[t.title?e("h2",[t._v("Заказы в статусе «"+t._s(t.title)+"»")]):e("h2",[t._v("Отмененные заказы")]),t._v(" "),t._l(t.orders,function(t){return e("div",{key:t.ORDER.ID,staticClass:"orders__small s-orders"},[e("current-order",{attrs:{order:t}})],1)})],2)])])},[],!1,null,null,null));r.default=h.exports}}]);